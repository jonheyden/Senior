<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LTC2984 Object Usage &mdash; Loop Controller and Remote I/O 0.0.1 documentation</title><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Shift Register Object Usage" href="shift_ex.html" />
    <link rel="prev" title="PID Object Usage" href="pid_ex.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Loop Controller and Remote I/O
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Schematics</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../schematics/inputcircuit.html">Input Circuit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../schematics/outputcircuit.html">Output Circuit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../schematics/ltc2984circuit.html">LTC2984 Circuit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../schematics/powercircuit.html">Power Circuit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../schematics/relaycircuit.html">Relay and Digital Out Circuits</a></li>
</ul>
<p class="caption"><span class="caption-text">Controller Function</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contfunction.html">Controller Function</a></li>
</ul>
<p class="caption"><span class="caption-text">API Examples</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="input_ex.html">Input Object Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="output_ex.html">Output Object Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="pid_ex.html">PID Object Usage</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">LTC2984 Object Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#ltc2984-object-purpose">LTC2984 Object Purpose</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#code-examples">Code Examples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="shift_ex.html">Shift Register Object Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="uart_ex.html">UART Object Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="settings_handler.html">Setting Handler</a></li>
<li class="toctree-l1"><a class="reference internal" href="settings_text.html">How To Format Data for UART</a></li>
<li class="toctree-l1"><a class="reference internal" href="in_pid_out.html">Putting It All Together</a></li>
</ul>
<p class="caption"><span class="caption-text">API References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../API_References/inputob.html">Input Conditioner</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API_References/outputob.html">Output Conditioner</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API_References/pidob.html">PID Object</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API_References/ltc.html">LTC2984</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API_References/shift.html">Shift Register</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API_References/uart.html">Uart Object</a></li>
<li class="toctree-l1"><a class="reference internal" href="../API_References/setting_ob.html">Settings Handler</a></li>
</ul>
<p class="caption"><span class="caption-text">Onion Omega Function</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Onion_Omega/Omega_Code.html">Code on Onion Omega</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Loop Controller and Remote I/O</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>LTC2984 Object Usage</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/API_Examples/ltc_ex.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="ltc2984-object-usage">
<h1>LTC2984 Object Usage<a class="headerlink" href="#ltc2984-object-usage" title="Permalink to this headline">¶</a></h1>
<div class="section" id="ltc2984-object-purpose">
<h2>LTC2984 Object Purpose<a class="headerlink" href="#ltc2984-object-purpose" title="Permalink to this headline">¶</a></h2>
<p>This objects purpose exists to provide a simple interface to the LTC2984. There are many different functions of the LTC2984, but for this class, we focus on it’s ability to measure thermocouples and RTD’s.</p>
<div class="section" id="code-examples">
<h3>Code Examples<a class="headerlink" href="#code-examples" title="Permalink to this headline">¶</a></h3>
<p>The first examples shows how to initialize the object. The user must provide a Chip Select (<span class="math notranslate nohighlight">\(\bar{CS}\)</span>) pin, and the common pins for SPI communication (MISO, MOSI, SCK). There is an optional interrupt pin, and for the purposes of this object, it is used.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Example initilization of object</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">board</span>
<span class="kn">import</span> <span class="nn">busio</span>
<span class="kn">import</span> <span class="nn">ltc2984</span>

<span class="c1">#LTC2984 Chip Select Pin</span>
<span class="n">ltc_cs</span> <span class="o">=</span> <span class="n">digitalio</span><span class="o">.</span><span class="n">DigitalInOut</span><span class="p">(</span><span class="n">board</span><span class="o">.</span><span class="n">D10</span><span class="p">)</span>
<span class="n">ltc_cs</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">digitalio</span><span class="o">.</span><span class="n">Direction</span><span class="o">.</span><span class="n">OUTPUT</span>
<span class="n">ltc_cs</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1">#Set high for active low chip select</span>

<span class="n">ltc_interrupt</span> <span class="o">=</span> <span class="n">digitalio</span><span class="o">.</span><span class="n">DigitalInOut</span><span class="p">(</span><span class="n">board</span><span class="o">.</span><span class="n">D37</span><span class="p">)</span>
<span class="n">ltc_interrupt</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">digitalio</span><span class="o">.</span><span class="n">Direction</span><span class="o">.</span><span class="n">INPUT</span>

<span class="n">ltcspi</span> <span class="o">=</span> <span class="n">busio</span><span class="o">.</span><span class="n">SPI</span><span class="p">(</span><span class="n">board</span><span class="o">.</span><span class="n">SCK</span><span class="p">,</span> <span class="n">board</span><span class="o">.</span><span class="n">MOSI</span><span class="p">,</span> <span class="n">board</span><span class="o">.</span><span class="n">MISO</span><span class="p">)</span>

<span class="c1"># Initialize the input object</span>
<span class="n">ltc_obj</span> <span class="o">=</span> <span class="n">ltc2984</span><span class="o">.</span><span class="n">ltc2984</span><span class="p">(</span><span class="n">ltcspi</span><span class="p">,</span> <span class="n">ltc_cs</span><span class="p">,</span> <span class="n">ltc_interrupt</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>There are a couple of helper functions to create assignment data for the LTC2984. These assignments assume that the LTC2984 has a cold junction reference on channel 20 for thermocouples, and a sense resistor on channel 2 for RTD’s. Please reference the LTC2984 Users Manual for more information on the assignment data if these channels are different for your use.</p>
<p>For Thermocouples, the ltc2984.generate_thermocouple_assignment_data() function can be used to create the assigment data. The function takes in a value from 1-8 that relates to thermocouple type.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Using the same ltc2984 object from above</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Type J = 1</span>
<span class="sd">Type K = 2</span>
<span class="sd">Type E = 3</span>
<span class="sd">Type N = 4</span>
<span class="sd">Type R = 5</span>
<span class="sd">Type S = 6</span>
<span class="sd">Type T = 7</span>
<span class="sd">Type B = 8</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">channel3_assignment</span> <span class="o">=</span> <span class="n">ltc_obj</span><span class="o">.</span><span class="n">generate_thermocouple_assignment_data</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>For RTD’s, the ltc2984.generate_rtd_assignment_data() function can be used to create the assigment data. The function takes in a value from 10-17 that relates to RTD type, as well as a wire count should it be a 2, 3, or 4 wire device.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Using the same ltc2984 object from above</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">PT 10 = 10</span>
<span class="sd">PT 50 = 11</span>
<span class="sd">PT 100 = 12</span>
<span class="sd">PT 200 = 13</span>
<span class="sd">PT 500 = 14</span>
<span class="sd">PT 1000 = 15</span>
<span class="sd">PT 1000 375 = 16</span>
<span class="sd">NI 120 = 17</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">channel8_assignment</span> <span class="o">=</span> <span class="n">ltc_obj</span><span class="o">.</span><span class="n">generate_rtd_assignment_data</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Only channels 4, 8, 12, and 16 are available for RTD assignment if the LTC2984 is being configured the same as the hardware documents reference.</p>
</div>
<p>There is a channel assignment function that can be called, which needs to be passed a valid channel number (1-20) as well as valid data. The function can be called with the ltc2984.chan_assignment() function.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Using the same ltc9284 object from above and channel assignment data.</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ltc_obj</span><span class="o">.</span><span class="n">chan_assignment</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">channel3_assignment</span><span class="p">)</span>
<span class="n">ltc_obj</span><span class="o">.</span><span class="n">chan_assignment</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">channel8_assignment</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>If the user has a 2k sense resistor and a cold junction diode, these are the configuration values necessary as well as the assignment channels.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">Using the same ltc9284 object from above and channel assignment data.</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sense_resistor_constant</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0x1d</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mh">0x1F4000</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">ltc_obj</span><span class="o">.</span><span class="n">chan_assignment</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">sense_resistor_constant</span><span class="p">)</span>

<span class="n">cold_junction</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0x1c</span> <span class="o">&lt;&lt;</span> <span class="mi">27</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">26</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">25</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mh">0x0</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mh">0x1</span> <span class="o">&lt;&lt;</span> <span class="mi">22</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mh">0x100c49</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">ltc_obj</span><span class="o">.</span><span class="n">chan_assignment</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">cold_junction</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Once the user has set the channels, conversion requests can be made to the LTC2984. There are multiple functions that will allow the user to request a conversion, and depending on the pins used, the user can request the data in multiple ways.</p>
<p>The first option is if the user chooses not to wire the interrupt pin. The ltc2984.check_conv() function will return false until the conversion is complete. It will send a request to the LTC2984 and wait for the conversion complete bit to be set.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">Using the same ltc9284 object from above and channel assignment data.</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Request conversion for channels 3 and 8</span>
<span class="n">ltc_obj</span><span class="o">.</span><span class="n">chan_conv</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ltc_obj</span><span class="o">.</span><span class="n">chan_conv</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="c1">#Wait for conversion to complete</span>
<span class="k">while</span> <span class="p">(</span><span class="ow">not</span> <span class="n">ltc_obj</span><span class="o">.</span><span class="n">check_conv</span><span class="p">()):</span>
   <span class="n">ltc_obj</span><span class="o">.</span><span class="n">check_conv</span><span class="p">()</span>
<span class="c1">#Read the conversion results</span>
<span class="n">channel3_data</span> <span class="o">=</span> <span class="n">ltc_obj</span><span class="o">.</span><span class="n">read_chan</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">channel8_data</span> <span class="o">=</span> <span class="n">ltc_obj</span><span class="o">.</span><span class="n">read_chan</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Another option, using the interrupt pin, lets the user set a hardware interrupt that signifies when the results are ready to be read, allowing the user to do other things but recieve the data as soon as it’s ready. The interrupt pin is pulled low when the device is busy, high when it is ready.</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">Using the same ltc9284 object from above and channel assignment data.</span><a class="headerlink" href="#id7" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Request conversion for channels 3 and 8</span>
<span class="n">ltc_obj</span><span class="o">.</span><span class="n">chan_conv</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ltc_obj</span><span class="o">.</span><span class="n">chan_conv</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="c1">#Wait for conversion to complete</span>
<span class="k">if</span> <span class="p">(</span><span class="n">ltc_obj</span><span class="o">.</span><span class="n">check_interrupt</span><span class="p">):</span>
   <span class="c1">#Read the conversion results</span>
   <span class="n">channel3_data</span> <span class="o">=</span> <span class="n">ltc_obj</span><span class="o">.</span><span class="n">read_chan</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
   <span class="n">channel8_data</span> <span class="o">=</span> <span class="n">ltc_obj</span><span class="o">.</span><span class="n">read_chan</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The last function will request and convert the channel when it is ready. This function is use to verify functionality but is not reccomended for use in a system. It is only setup to do one channel at a time.</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">Using the same ltc9284 object from above and channel assignment data.</span><a class="headerlink" href="#id8" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">channel3_data</span> <span class="o">=</span> <span class="n">convert_and_read</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="pid_ex.html" class="btn btn-neutral float-left" title="PID Object Usage" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="shift_ex.html" class="btn btn-neutral float-right" title="Shift Register Object Usage" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Chris Heyden.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>